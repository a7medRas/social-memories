<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>جدار الذكريات</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      margin: 0; padding: 0;
      color: #222;
    }
    header {
      background: #4267B2;
      color: white;
      padding: 10px 20px;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 15px;
      font-size: 18px;
    }
    header button {
      background: transparent;
      border: none;
      color: white;
      cursor: pointer;
      font-weight: bold;
      padding: 6px 10px;
      border-radius: 4px;
      transition: background 0.3s;
    }
    header button:hover {
      background: rgba(255,255,255,0.2);
    }
    #content > div {
      display: none;
      padding: 20px;
      max-width: 700px;
      margin: 20px auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    #content > div.active {
      display: block;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin: 6px 0 12px;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button.primary {
      background: #4267B2;
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      border-radius: 4px;
      font-weight: bold;
    }
    button.primary:hover {
      background: #365899;
    }
    .memory {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
    .memory:last-child {
      border-bottom: none;
    }
    .memory-title {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 4px;
    }
    .memory-state {
      font-style: italic;
      margin-bottom: 8px;
    }
    .memory-desc {
      margin-bottom: 8px;
    }
    .memory-img {
      max-width: 100%;
      border-radius: 6px;
      margin-bottom: 8px;
    }
    .actions button {
      margin-right: 10px;
      cursor: pointer;
      background: transparent;
      border: none;
      color: #4267B2;
      font-weight: bold;
      transition: color 0.3s;
    }
    .actions button:hover {
      color: #365899;
    }
    .comment {
      border-top: 1px solid #eee;
      padding-top: 6px;
      margin-top: 6px;
      font-size: 14px;
    }
    .comment strong {
      margin-right: 6px;
    }
    /* Chat styles */
    #chatMessages {
      height: 300px;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 8px;
      border-radius: 6px;
      background: #fafafa;
      margin-bottom: 10px;
    }
    #chatMessages .msg {
      margin-bottom: 8px;
      padding: 6px 10px;
      border-radius: 8px;
      max-width: 70%;
      clear: both;
    }
    #chatMessages .msg.user {
      background: #4267B2;
      color: white;
      float: right;
      text-align: right;
    }
    #chatMessages .msg.other {
      background: #ddd;
      color: #222;
      float: left;
      text-align: left;
    }
    #searchResults li {
      list-style: none;
      margin-bottom: 8px;
    }
    #searchResults li a {
      color: #4267B2;
      text-decoration: none;
      font-weight: bold;
    }
    #searchResults li a:hover {
      text-decoration: underline;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>

<header>
  <button id="btnLive">🔴 Live</button>
  <button id="btnChat">💬 الدردشة</button>
  <button id="btnSearch">🔍 البحث عن مستخدمين</button>
  <button id="btnNewMemory">➕ ذكرى جديدة</button>
  <div id="loginStatus" style="margin-left:auto; font-weight:bold;"></div>
</header>

<div id="content">

  <!-- Memories section -->
  <div id="memoriesSection" class="active">
    <h2>ذكريات المستخدم</h2>
    <div id="memoriesList">جارٍ تحميل الذكريات...</div>
  </div>

  <!-- New Memory form -->
  <div id="newMemorySection">
    <h2>نشر ذكرى جديدة</h2>
    <form id="memoryForm">
      <label>العنوان:</label>
      <input type="text" id="memoryTitle" required />
      <label>الوصف:</label>
      <textarea id="memoryDesc" rows="4" required></textarea>
      <label>الحالة:</label>
      <select id="memoryState" required>
        <option value="" disabled selected>اختر الحالة</option>
        <option value="سعيد">سعيد 😊</option>
        <option value="فرح">فرح 😄</option>
        <option value="محب">محب ❤️</option>
        <option value="حزين">حزين 😢</option>
        <option value="متأمل">متأمل 🤔</option>
      </select>
      <label>صورة (اختياري):</label>
      <input type="file" id="memoryImage" accept="image/*" capture="environment" />
      <button type="submit" class="primary">نشر الذكرى</button>
      <button type="button" id="cancelNewMemory" style="margin-left:10px;">إلغاء</button>
    </form>
  </div>

  <!-- Chat section -->
  <div id="chatSection">
    <h2>الدردشة</h2>
    <div id="chatMessages"></div>
    <form id="chatForm">
      <input type="text" id="chatInput" placeholder="اكتب رسالة..." autocomplete="off" required />
      <button type="submit" class="primary">إرسال</button>
    </form>
  </div>

  <!-- Search users -->
  <div id="searchSection">
    <h2>البحث عن المستخدمين</h2>
    <input type="text" id="searchInput" placeholder="ابحث باسم المستخدم..." />
    <ul id="searchResults"></ul>
  </div>

</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
  // Firebase config - ضع هنا إعدادات Firebase الخاصة بك
  const firebaseConfig = {
    apiKey: "AIzaSyCKKkHfKFfwlgnEju0sk0s46t3DnG0bhtE",
    authDomain: "social-memories-89ec5.firebaseapp.com",
    projectId: "social-memories-89ec5",
    storageBucket: "social-memories-89ec5.appspot.com",
    messagingSenderId: "227392608508",
    appId: "1:227392608508:web:450fc4d2dece0329f39f79"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();
  const storage = firebase.storage();

  // DOM elements
  const btnLive = document.getElementById("btnLive");
  const btnChat = document.getElementById("btnChat");
  const btnSearch = document.getElementById("btnSearch");
  const btnNewMemory = document.getElementById("btnNewMemory");

  const memoriesSection = document.getElementById("mem
