<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Social Memories - Firebase</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0; background: #f0f2f5;
  }
  nav {
    display: flex;
    justify-content: space-around;
    background: #007bff;
    color: white;
    padding: 12px 0;
    position: fixed;
    width: 100%;
    bottom: 0;
    z-index: 10;
  }
  nav button {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
  }
  nav button:hover {
    text-decoration: underline;
  }
  #content > div {
    display: none;
    padding: 16px;
    margin-bottom: 60px; /* space for fixed nav */
  }
  #content > div.active {
    display: block;
  }
  .memory {
    background: white;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 6px;
  }
  .memory-buttons button {
    margin-left: 10px;
    cursor: pointer;
  }
  .comment {
    background: #eef1f6;
    margin: 6px 0 6px 20px;
    padding: 6px;
    border-radius: 4px;
  }
  .chat-window {
    height: 300px;
    border: 1px solid #ccc;
    background: white;
    overflow-y: auto;
    padding: 8px;
    border-radius: 6px;
    margin-bottom: 8px;
  }
  .chat-message {
    margin-bottom: 6px;
  }
  .chat-message.user {
    text-align: right;
    font-weight: bold;
  }
  input[type="text"], select, textarea {
    width: 100%;
    padding: 8px;
    margin: 6px 0 12px 0;
    box-sizing: border-box;
    font-size: 16px;
  }
  button.submit-btn {
    background: #007bff;
    color: white;
    border: none;
    padding: 10px;
    width: 100%;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
  }
  button.submit-btn:hover {
    background: #0056b3;
  }
  ul#searchResults {
    list-style: none;
    padding: 0;
  }
  ul#searchResults li {
    background: white;
    margin-bottom: 6px;
    padding: 8px;
    border-radius: 6px;
    cursor: pointer;
  }
  ul#searchResults li:hover {
    background: #cce5ff;
  }
  #loginSection {
    padding: 16px;
  }
  #logoutBtn {
    background: #dc3545;
    color: white;
    border: none;
    padding: 8px 12px;
    cursor: pointer;
    border-radius: 4px;
    float: left;
  }
</style>
</head>
<body>

<nav>
  <button id="btnLive">ğŸ”´ Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±</button>
  <button id="btnChat">ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø©</button>
  <button id="btnSearch">ğŸ” Ø¨Ø­Ø« Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
  <button id="btnNewMemory">ğŸ“ Ù†Ø´Ø± Ø°ÙƒØ±Ù‰ Ø¬Ø¯ÙŠØ¯Ø©</button>
  <button id="logoutBtn" style="display:none;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</nav>

<div id="content">
  <div id="loginSection" class="active">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <input type="email" id="emailInput" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required />
    <input type="password" id="passwordInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required />
    <button id="loginBtn" class="submit-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    <p>Ø£Ùˆ <button id="signupBtn" class="submit-btn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button></p>
    <p id="loginMsg" style="color:red;"></p>
  </div>

  <div id="memoriesSection">
    <h2>ğŸ“¸ Ø°ÙƒØ±ÙŠØ§Øª</h2>
    <div id="memoriesList">
      Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
    </div>
  </div>

  <div id="chatSection">
    <h2>ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø©</h2>
    <div class="chat-window" id="chatWindow"></div>
    <input type="text" id="chatInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." />
    <button id="sendChatBtn" class="submit-btn">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>

  <div id="searchSection">
    <h2>ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
    <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…..." autocomplete="off"/>
    <ul id="searchResults"></ul>
  </div>

  <div id="newMemorySection">
    <h2>ğŸ“ Ù†Ø´Ø± Ø°ÙƒØ±Ù‰ Ø¬Ø¯ÙŠØ¯Ø©</h2>
    <form id="memoryForm">
      <input type="text" id="memoryTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø°ÙƒØ±Ù‰" required />
      <textarea id="memoryText" placeholder="Ø§ÙƒØªØ¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø°ÙƒØ±Ù‰..." rows="4" required></textarea>
      <label for="moodSelect">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ø¬ÙŠØ©:</label>
      <select id="moodSelect" required>
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø©</option>
        <option value="Ø³Ø¹ÙŠØ¯Ø©">ğŸ˜Š Ø³Ø¹ÙŠØ¯Ø©</option>
        <option value="ÙØ±Ø­">ğŸ˜„ ÙØ±Ø­</option>
        <option value="Ù…Ø­Ø¨Ø©">â¤ï¸ Ù…Ø­Ø¨Ø©</option>
        <option value="Ø­Ø²Ù†">ğŸ˜¢ Ø­Ø²Ù†</option>
        <option value="ØºØ¶Ø¨">ğŸ˜  ØºØ¶Ø¨</option>
      </select>
      <br />
      <label for="memoryImage">ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label><br />
      <input type="file" id="memoryImage" accept="image/*" capture="environment" />
      <br /><br />
      <button type="submit" class="submit-btn">Ù†Ø´Ø± Ø§Ù„Ø°ÙƒØ±Ù‰</button>
    </form>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

<script>
// ======= Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ =======
const firebaseConfig = {
  apiKey: "Ø¶Ø¹ Ù‡Ù†Ø§ apiKey Ù…Ù† Firebase",
  authDomain: "Ø¶Ø¹ Ù‡Ù†Ø§ authDomain Ù…Ù† Firebase",
  projectId: "Ø¶Ø¹ Ù‡Ù†Ø§ projectId Ù…Ù† Firebase",
  storageBucket: "Ø¶Ø¹ Ù‡Ù†Ø§ storageBucket Ù…Ù† Firebase",
  messagingSenderId: "Ø¶Ø¹ Ù‡Ù†Ø§ messagingSenderId Ù…Ù† Firebase",
  appId: "Ø¶Ø¹ Ù‡Ù†Ø§ appId Ù…Ù† Firebase"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

// Ø¹Ù†Ø§ØµØ± DOM
const loginSection = document.getElementById("loginSection");
const memoriesSection = document.getElementById("memoriesSection");
const chatSection = document.getElementById("chatSection");
const searchSection = document.getElementById("searchSection");
const newMemorySection = document.getElementById("newMemorySection");

const logoutBtn = document.getElementById("logoutBtn");

const btnLive = document.getElementById("btnLive");
const btnChat = document.getElementById("btnChat");
const btnSearch = document.getElementById("btnSearch");
const btnNewMemory = document.getElementById("btnNewMemory");

const memoriesList = document.getElementById("memoriesList");

const chatWindow = document.getElementById("chatWindow");
const chatInput = document.getElementById("chatInput");
const sendChatBtn = document.getElementById("sendChatBtn");

const searchInput = document.getElementById("searchInput");
const searchResults = document.getElementById("searchResults");

const memoryForm = document.getElementById("memoryForm");
const memoryTitle = document.getElementById("memoryTitle");
const memoryText = document.getElementById("memoryText");
const moodSelect = document.getElementById("moodSelect");
const memoryImage = document.getElementById("memoryImage");

const emailInput = document.getElementById("emailInput");
const passwordInput = document.getElementById("passwordInput");
const loginBtn = document.getElementById("loginBtn");
const signupBtn = document.getElementById("signupBtn");
const loginMsg = document.getElementById("loginMsg");

let currentUser = null;

function hideAllSections() {
  loginSection.style.display = "none";
  memoriesSection.style.display = "none";
  chatSection.style.display = "none";
  searchSection.style.display = "none";
  newMemorySection.style.display = "none";
  logoutBtn.style.display = "none";
}

function showSection(section) {
  hideAllSections();
  section.style.display = "block";
  if(section !== loginSection){
    logoutBtn.style.display = "inline-block";
  }
}

btnLive.addEventListener("click", () => {
  alert("âš ï¸ Ø®Ø§ØµÙŠØ© Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù‚ÙŠØ¯ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø­Ø§Ù„ÙŠØ§Ù‹");
});
btnChat.addEventListener("click", () => showSection(chatSection));
btnSearch.addEventListener("click", () => showSection(searchSection));
btnNewMemory.addEventListener("click", () => showSection(newMemorySection));
logoutBtn.addEventListener("click", () => {
  auth.signOut();
});

// ======= ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ =======
loginBtn.onclick = () => {
  loginMsg.textContent = "";
  const email = emailInput.value.trim();
  const password = passwordInput.value.trim();
  if(!email || !password) {
    loginMsg.textContent = "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.";
    return;
  }
  auth.signInWithEmailAndPassword(email, password)
    .then(() => {
      loginMsg.textContent = "";
    })
    .catch(err => {
      loginMsg.textContent = "Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: " + err.message;
    });
};

signupBtn.onclick = () => {
  loginMsg.textContent = "";
  const email = emailInput.value.trim();
  const password = passwordInput.value.trim();
  if(!email || !password) {
    loginMsg.textContent = "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.";
    return;
  }
  auth.createUserWithEmailAndPassword(email, password)
    .then(() => {
      loginMsg.textContent = "";
    })
    .catch(err => {
      loginMsg.textContent = "Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨: " + err.message;
    });
};

// ======= Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ =======
auth.onAuthStateChanged(user => {
  if(user){
    currentUser = user;
    showSection(memoriesSection);
    loadMemories();
    listenToChats();
    loadUsers();
  } else {
    currentUser = null;
    showSection(loginSection);
  }
});

// ======= Ø¹Ø±Ø¶ Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª Ù…Ù† Firestore =======
function loadMemories(){
  memoriesList.innerHTML = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª...";
  db.collection("memories")
    .orderBy("createdAt", "desc")
    .onSnapshot(snapshot => {
      memoriesList.innerHTML = "";
      if(snapshot.empty){
        memoriesList.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø°ÙƒØ±ÙŠØ§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>";
        return;
      }
      snapshot.forEach(doc => {
        const memory = doc.data();
        const div = document.createElement("div");
       
